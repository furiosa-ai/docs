<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nux C API: Toolchains for Furiosa NPU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Nux C API
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">C API of NPU Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Toolchains for Furiosa NPU </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://bors.furiosa.dev/repositories/2"><object type="image/svg+xml" data="https://bors.tech/images/badge_small.svg" style="pointer-events: none;">Bors enabled</object></a> <a href="https://github.com/furiosa-ai/npu-tools/actions?query=workflow%3Abuild"><object type="image/svg+xml" data="https://github.com/furiosa-ai/npu-tools/workflows/build/badge.svg" style="pointer-events: none;">Build Status (macOS)</object></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Requirement</h1>
<ul>
<li>Install <code>rustfmt</code> and <code>clippy</code> components:</li>
</ul>
<div class="fragment"><div class="line">$ cd &lt;workspace&gt;/npu-tools</div>
<div class="line">$ rustup component add rustfmt clippy</div>
</div><!-- fragment --><ul>
<li><p class="startli">The Rust version we will use is specified in the <code>rust-toolchain</code> file. If you want to bump rust version, just edit the file.</p>
<p class="startli">Do not override rust version:</p>
</li>
</ul>
<div class="fragment"><div class="line">$ rustup override unset</div>
</div><!-- fragment --><ul>
<li><p class="startli">Install <code>protoc</code> to generate files from <code>protobuf</code> scheme:</p>
<p class="startli"><a href="http://google.github.io/proto-lens/installing-protoc.html">http://google.github.io/proto-lens/installing-protoc.html</a></p>
</li>
<li>On Ubuntu, the following command should install the required dependencies.</li>
</ul>
<div class="fragment"><div class="line">$ sudo apt install cmake libsdl2-image-dev libsdl2-ttf-dev</div>
<div class="line"> </div>
<div class="line">$ curl --location --remote-name https://github.com/hyunsik/onnxruntime/releases/download/v1.8.1/libonnxruntime-1.8.1_amd64.deb</div>
<div class="line">$ sudo apt install ./libonnxruntime-1.8.1_amd64.deb</div>
</div><!-- fragment --><ul>
<li>On macOS, the following command should install the required library for executing build scripts. <div class="fragment"><div class="line">$ brew install coreutils</div>
<div class="line">$ cd $(brew --repository)/Library/Taps/homebrew/homebrew-core &amp;&amp; \</div>
<div class="line">  git checkout d079765d9718e88def8dd42ffc3cdfa46d1ee8a6 -- Formula/onnxruntime.rb &amp;&amp; \</div>
<div class="line">  (brew unpin onnxruntime || true) &amp;&amp;</div>
<div class="line">  (brew uninstall onnxruntime || true) &amp;&amp;</div>
<div class="line">  (brew install onnxruntime || brew install --build-from-source onnxruntime) &amp;&amp; \</div>
<div class="line">  brew pin onnxruntime &amp;&amp; \</div>
<div class="line">  git checkout HEAD -- Formula/onnxruntime.rb</div>
</div><!-- fragment --></li>
<li>Update Git submodules: <div class="fragment"><div class="line">$ git submodule update --init --recursive</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Test</h1>
<ul>
<li><p class="startli">Simply, run the following command.</p>
<p class="startli">``<code>bash $ cargo test --release --target x86_64-unknown-linux-gnu # or</code>cargo test &ndash;release &ndash;target x86_64-apple-darwin` </p><div class="fragment"><div class="line">  Note that the `--target` option should be specified to avoid the `output filename collision` warnings. See https://furiosa-ai.slack.com/archives/C7F3LNU2Y/p1615704388155700?thread_ts=1614311907.124700&amp;cid=C7F3LNU2Y for details.</div>
<div class="line"> </div>
<div class="line">## MLIR</div>
<div class="line"> </div>
<div class="line">To compile external operators using MLIR,</div>
<div class="line"> </div>
<div class="line">- Install LLVM with MLIR. (See instructions at https://github.com/furiosa-ai/mlir-rs.)</div>
<div class="line"> </div>
<div class="line">- Enable feature `mlir` while compile and test. For example:</div>
<div class="line"> </div>
<div class="line">  ``` bash</div>
<div class="line">  $ cargo test --release --target x86_64-unknown-linux-gnu --features mlir</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Execution Back-ends</h1>
<p><code>npu-sim</code> is used as an NPU back-end by default. Additionally, there are 2 features for <code>npu-library</code>, <code>npu-test</code>, and <code>npu-dnn</code> to select the execution back-end.</p>
<ol type="1">
<li>"use_npu": this uses <a href="https://github.com/furiosa-ai/npu_aio">libnpu</a> as an NPU back-end.</li>
<li>"use_cas": this uses a cycle-accurate simulator(libnpu_cas) as an NPU back-end.</li>
</ol>
<p>These features require the corresponding library installed in the system.</p>
<div class="fragment"><div class="line">$ (cd crates/npu-dnn &amp;&amp; cargo test --features use_npu)</div>
<div class="line">$ (cd crates/npu-test &amp;&amp; cargo test --features use_cas)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Upgrade dependencies</h1>
<div class="fragment"><div class="line">$ cargo install cargo-edit</div>
<div class="line">$ cargo upgrade --all</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Organization</h1>
<p>This repository consists of the following crates:</p>
<ul>
<li><code>npu-alu</code>, a linear algebra library for NPU</li>
<li><code>npu-api</code>, a common set of NPU APIs, <code>npu-sim</code> and <code>npu-library</code> crates use these APIs to provide compatibility for user applications.</li>
<li><code>npu-compiler</code>, a compiler for NPU</li>
<li><code>npu-isa</code>, a set of NPU assembly instructions</li>
<li><code>npu-library</code> provides Rust bindings for <a href="https://github.com/furiosa-ai/npu_aio">libnpu</a>.</li>
<li><code>npu-sim</code>, a simulator library for NPU</li>
<li><code>npu-test</code>, a set of tests for NPU</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Contributing</h1>
<p>Before starting to write code, see the coding convention. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
